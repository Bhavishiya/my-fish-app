<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prajnin Sai Aquatics - Premium Fish Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .header-btn {
            padding: 10px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .header-btn:hover {
            background: white;
            color: #1e3c72;
            transform: translateY(-2px);
        }

        .products {
            padding: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 1.4em;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .product-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .product-price {
            font-size: 1.5em;
            color: #2a5298;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .order-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .order-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .admin-content {
            max-width: 600px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
        }

        .admin-close {
            float: right;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }

        .admin-close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload-input {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }

        .file-upload-label {
            display: block;
            padding: 12px;
            background: #f0f0f0;
            border: 2px dashed #1e3c72;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #e8e8e8;
            border-color: #2a5298;
        }

        .file-upload-label.has-file {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .product-list {
            margin-top: 30px;
        }

        .product-list-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .upload-progress {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            text-align: center;
            color: #1976d2;
        }

        footer {
            background: #1e3c72;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .products {
                padding: 20px;
                grid-template-columns: 1fr;
            }

            .admin-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêü Prajnin Sai Aquatics</h1>
            <p class="tagline">Premium Quality Fish Market - Fresh from the Ocean to Your Door</p>
            <div class="header-buttons">
                <a href="https://instagram.com" target="_blank" class="header-btn">üì∑ Instagram</a>
                <a href="https://youtube.com" target="_blank" class="header-btn">‚ñ∂Ô∏è YouTube</a>
                <button class="header-btn" onclick="openAdmin()">üîê Admin</button>
            </div>
        </header>

        <div id="products" class="products">
            <!-- Products will be loaded here -->
        </div>

        <footer>
            <p>&copy; 2025 Prajnin Sai Aquatics. All rights reserved.</p>
            <p>Fresh Fish | Premium Quality | Fast Delivery</p>
        </footer>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-content">
            <span class="admin-close" onclick="closeAdmin()">&times;</span>
            <div id="loginForm" class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px;">Admin Login</h2>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button class="btn" onclick="login()" style="width: 100%;">Login</button>
            </div>

            <div id="adminForm" style="display: none;">
                <h2 style="margin-bottom: 20px;">Manage Products</h2>
                <div id="alertContainer"></div>
                
                <form id="productForm" onsubmit="saveProduct(event)">
                    <div class="form-group">
                        <label>Fish Name *</label>
                        <input type="text" id="productName" required placeholder="e.g., Golden Fish">
                    </div>

                    <div class="form-group">
                        <label>Price (‚Çπ) *</label>
                        <input type="number" id="productPrice" required placeholder="e.g., 2000" step="0.01">
                    </div>

                    <div class="form-group">
                        <label>Description *</label>
                        <textarea id="productDescription" required placeholder="Describe your fish..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Upload Fish Image *</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="productImage" class="file-upload-input" accept="image/*" onchange="previewImage(this)">
                            <label for="productImage" class="file-upload-label" id="fileLabel">
                                üì∏ Click to choose image
                            </label>
                        </div>
                        <img id="imagePreview" class="image-preview">
                        <div id="uploadProgress" class="upload-progress">Uploading image...</div>
                    </div>

                    <input type="hidden" id="editId">
                    <button type="submit" class="btn">üíæ Save Product</button>
                    <button type="button" class="btn" onclick="resetForm()">Clear Form</button>
                </form>

                <div class="product-list">
                    <h3>Current Products</h3>
                    <div id="productListContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====================================
        // SUPABASE CONFIGURATION
        // ====================================
        // IMPORTANT: Replace these with your actual Supabase credentials
        
        const SUPABASE_URL = 'https://kwrhucwzjkglxitfkgyq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_hi9RDjxH6-guN8kKBvCPGA_ZVsulKLu
'; 
        
        // ====================================

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // WhatsApp number
        const WHATSAPP_NUMBER = '918124339528';

        // Admin password
        const ADMIN_PASSWORD = 'prahinadmin123';

        // Default products (will be loaded on first use if database is empty)
        const defaultProducts = [
            {
                name: "Atlantic Salmon",
                price: 2099,
                description: "Fresh Atlantic salmon, rich in omega-3. Perfect for grilling.",
                image_url: "https://images.unsplash.com/photo-1574781330855-d0db8cc6a79c?w=500"
            },
            {
                name: "Bluefin Tuna",
                price: 3899,
                description: "Premium tuna, ideal for sushi. Sustainable catch.",
                image_url: "https://images.unsplash.com/photo-1599084993091-1cb5c0721cc6?w=500"
            },
            {
                name: "King Prawns",
                price: 2799,
                description: "Jumbo prawns, succulent and sweet.",
                image_url: "https://images.unsplash.com/photo-1565680018434-b513d5e5fd47?w=500"
            },
            {
                name: "Sea Bass",
                price: 2399,
                description: "Fresh sea bass with delicate flavor.",
                image_url: "https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=500"
            },
            {
                name: "Lobster",
                price: 4999,
                description: "Live lobster, the ultimate luxury seafood.",
                image_url: "https://images.unsplash.com/photo-1625937286074-9ca519d5d9df?w=500"
            },
            {
                name: "Rainbow Trout",
                price: 1599,
                description: "Farm-raised trout, tender and flavorful.",
                image_url: "https://images.unsplash.com/photo-1534043464124-3be32fe000c9?w=500"
            }
        ];

        // Initialize app
        window.onload = function() {
            loadProducts();
        };

        // Load products from Supabase
        async function loadProducts() {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) throw error;

                // If no products exist, add default products
                if (!data || data.length === 0) {
                    await loadDefaultProducts();
                    return;
                }

                displayProducts(data);
            } catch (error) {
                console.error('Error loading products:', error);
                showAlert('Error loading products. Please refresh the page.', 'error');
            }
        }

        // Load default products into database
        async function loadDefaultProducts() {
            try {
                const { error } = await supabase
                    .from('products')
                    .insert(defaultProducts);

                if (error) throw error;

                loadProducts(); // Reload to display
            } catch (error) {
                console.error('Error loading default products:', error);
            }
        }

        // Display products on page
        function displayProducts(products) {
            const container = document.getElementById('products');
            container.innerHTML = '';

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${product.image_url}" alt="${product.name}" class="product-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22400%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2240%22%3Eüêü%3C/text%3E%3C/svg%3E'">
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">‚Çπ${product.price.toFixed(2)}</div>
                        <button class="order-btn" onclick="orderViaWhatsApp('${product.name}', ${product.price})">
                            Order via WhatsApp ‚úì
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Order via WhatsApp
        function orderViaWhatsApp(name, price) {
            const message = `Hi! I want to order ${name} (‚Çπ${price})`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
        }

        // Admin Panel Functions
        function openAdmin() {
            document.getElementById('adminPanel').style.display = 'block';
        }

        function closeAdmin() {
            document.getElementById('adminPanel').style.display = 'none';
            resetForm();
        }

        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminForm').style.display = 'block';
                loadProductList();
            } else {
                alert('Incorrect password!');
            }
        }

        // Preview image before upload
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            const label = document.getElementById('fileLabel');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    label.textContent = '‚úì Image selected: ' + input.files[0].name;
                    label.classList.add('has-file');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Upload image to Supabase Storage
        async function uploadImage(file) {
            try {
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;
                const filePath = fileName;

                document.getElementById('uploadProgress').style.display = 'block';

                const { data, error } = await supabase.storage
                    .from('product-images')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                document.getElementById('uploadProgress').style.display = 'none';

                if (error) throw error;

                // Get public URL
                const { data: urlData } = supabase.storage
                    .from('product-images')
                    .getPublicUrl(filePath);

                return urlData.publicUrl;
            } catch (error) {
                document.getElementById('uploadProgress').style.display = 'none';
                throw error;
            }
        }

        // Save product (add or update)
        async function saveProduct(event) {
            event.preventDefault();

            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const description = document.getElementById('productDescription').value;
            const imageFile = document.getElementById('productImage').files[0];
            const editId = document.getElementById('editId').value;

            try {
                let imageUrl = '';

                // Upload image if new file selected
                if (imageFile) {
                    imageUrl = await uploadImage(imageFile);
                }

                const productData = {
                    name: name,
                    price: price,
                    description: description
                };

                // Only update image_url if new image was uploaded
                if (imageUrl) {
                    productData.image_url = imageUrl;
                }

                if (editId) {
                    // Update existing product
                    const { error } = await supabase
                        .from('products')
                        .update(productData)
                        .eq('id', editId);

                    if (error) throw error;
                    showAlert('Product updated successfully!', 'success');
                } else {
                    // Add new product - image is required for new products
                    if (!imageUrl) {
                        showAlert('Please select an image for the new product!', 'error');
                        return;
                    }
                    
                    productData.image_url = imageUrl;

                    const { error } = await supabase
                        .from('products')
                        .insert([productData]);

                    if (error) throw error;
                    showAlert('Product added successfully!', 'success');
                }

                resetForm();
                loadProducts();
                loadProductList();
            } catch (error) {
                console.error('Error saving product:', error);
                showAlert('Error saving product: ' + error.message, 'error');
            }
        }

        // Load product list in admin panel
        async function loadProductList() {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) throw error;

                const container = document.getElementById('productListContainer');
                container.innerHTML = '';

                data.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'product-list-item';
                    item.innerHTML = `
                        <div>
                            <strong>${product.name}</strong> - ‚Çπ${product.price}
                        </div>
                        <div>
                            <button class="btn" onclick="editProduct(${product.id})" style="padding: 8px 15px; margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.id})" style="padding: 8px 15px;">Delete</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
            } catch (error) {
                console.error('Error loading product list:', error);
            }
        }

        // Edit product
        async function editProduct(id) {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) throw error;

                document.getElementById('productName').value = data.name;
                document.getElementById('productPrice').value = data.price;
                document.getElementById('productDescription').value = data.description;
                document.getElementById('editId').value = data.id;

                // Show current image
                const preview = document.getElementById('imagePreview');
                preview.src = data.image_url;
                preview.style.display = 'block';
                
                document.getElementById('fileLabel').textContent = 'Change image (optional - leave blank to keep current)';

                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading product:', error);
                showAlert('Error loading product for editing', 'error');
            }
        }

        // Delete product
        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                showAlert('Product deleted successfully!', 'success');
                loadProducts();
                loadProductList();
            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('Error deleting product', 'error');
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('fileLabel').textContent = 'üì∏ Click to choose image';
            document.getElementById('fileLabel').classList.remove('has-file');
        }

        // Show alert message
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>
